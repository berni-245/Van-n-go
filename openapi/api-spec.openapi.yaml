openapi: 3.1.2
info:
  title: Transport Booking API
  version: 1.0.0
  description: >
    ## Overview

    API for booking vehicles owned by drivers, used by clients.

    ## Authentication

    Methods requiring authentication should send the header `Authentication: Bearer <token>`.
    The <token> is a jwt and may be obtained by making a request to any endpoint with the header
    `Authentication: Basic <credentials>`, where `<credentials>` is the Base64 encoding of
    `<username>:<password>`. If the credentials are correct then the server will reply with the
    normal endpoint's response and a jwt in the header `vango-auth-token: <token>` and
    `vango-refresh-token: <refresh-token>`.

servers:
  - url: http://localhost:8080/api
    description: Development Server

tags:
  - name: Clients
    description: Operations related to clients.
  - name: Drivers
    description: Operations related to drivers.
  - name: Vehicles
    description: Operations related to vehicles.
  - name: Bookings
    description: Operations related to bookings
  - name: Messages
    description: Operations related to messages
  - name: Zones
    description: Operations related to zones

paths:
  /clients:
    post:
      summary: Create a new client
      description: Registers a new client account in the system.
      operationId: createClient
      tags:
        - Clients
      requestBody:
        required: true
        description: >
          Client information required to create a new client account.
          The email address must be unique.
        content:
          # TODO: use custom versioned mimetype?
          application/json:
            schema:
              $ref: "schemas/requests/client-create.yaml"
      responses:
        "201":
          description: Client created
          headers:
            Location:
              description: URI of the created client
              schema:
                type: string
                example: "api/clients/13"
          content:
            application/json:
              schema:
                $ref: "schemas/responses/client.yaml"
        "400":
          $ref: "schemas/errors/bad-request.yaml"
        "409":
          $ref: "schemas/errors/conflict.yaml"

  /clients/{clientId}:
    get:
      parameters:
        - $ref: "#/components/parameters/ClientIdPath"
      summary: Get information of a Client
      description: Given a client ID, obtain the information of a Client.
      operationId: getClientById
      tags:
        - Clients
      responses:
        "200":
          description: Information of a client
          content:
            application/json:
              schema:
                $ref: "schemas/responses/client.yaml"
        "401":
          $ref: "schemas/errors/unauthorized.yaml"
        "404":
          $ref: "schemas/errors/not-found.yaml"
    patch:
      parameters:
        - $ref: "#/components/parameters/ClientIdPath"
      summary: Update client information
      description: Given a client ID, update the specified information of a Client.
      operationId: updateClientById
      tags:
        - Clients
      requestBody:
        required: true
        description: Fields that may be updated for an existing client.
        content:
          application/json:
            schema:
              $ref: "schemas/requests/client-update.yaml"
      responses:
        "200":
          description: Client updated successfully
          content:
            application/json:
              schema:
                $ref: "schemas/responses/client.yaml"
        "400":
          $ref: "schemas/errors/bad-request.yaml"
        "401":
          $ref: "schemas/errors/unauthorized.yaml"
        "403":
          $ref: "schemas/errors/forbidden.yaml"
        "404":
          $ref: "schemas/errors/not-found.yaml"

  /clients/{clientId}/profile-picture:
    get:
      parameters:
        - $ref: "#/components/parameters/ClientIdPath"
      summary: Get the profile picture.
      description: Get the profile picture of the client id.
      operationId: getClientProfilePicture
      tags:
        - Clients
      responses:
        "200":
          description: Client's profile picture
          $ref: "schemas/image.yaml"
        "401":
          $ref: "schemas/errors/unauthorized.yaml"
        "404":
          $ref: "schemas/errors/image-not-found.yaml"
    post:
      parameters:
        - $ref: "#/components/parameters/ClientIdPath"
      tags:
        - Clients
      summary: Upload client profile picture
      description: Uploads or replaces the profile picture for a client (format PNG or JPG).
      operationId: uploadClientProfilePicture
      requestBody:
        required: true
        description: Image file to use as the client’s profile picture
        $ref: "schemas/image.yaml"
      responses:
        "201":
          description: Profile picture uploaded
          headers:
            Location:
              description: URI of the uploaded image
              schema:
                type: string
                example: "api/client/42/profile-picture"
        "401":
          $ref: "schemas/errors/unauthorized.yaml"
        "403":
          $ref: "schemas/errors/forbidden.yaml"
        "415":
          $ref: "schemas/errors/unsupported-media-type.yaml"

  /drivers:
    get:
      summary: Get list of all drivers in the system.
      parameters:
        - name: originZoneId
          description: Get only drivers on a specific starting zone
          in: query
          required: true
          schema:
            type: integer
        - name: size
          description: Get only drivers that have a vehicle of an specific size
          in: query
          schema:
            $ref: "schemas/enums/vehicle-size.yaml"
        - name: maxPrice
          # TODO: era precio por hora o distancia o qué?
          description: Get only drivers whose rate is lower that specified value
          in: query
          schema:
            type: number
            format: float
        - name: weekDay
          # TODO: esto se fija en availability o solo en si trabaja en ese día particular?
          description: Get only drivers who have availability on the specified day
          in: query
          schema:
            $ref: "schemas/enums/day.yaml"
        - name: minRating
          description: Get only drivers whose rating is above the specified value
          in: query
          schema:
            type: integer
        - name: sortOrder
          description: Sort drivers by the specified criteria
          in: query
          schema:
            type: string
            default: ALPHABETICAL
            enum: [ALPHABETICAL, "LEAST_PRICE", "BEST_RATING"]
        - $ref: "#/components/parameters/PaginationQuery"
      operationId: listDrivers
      tags:
        - Drivers
      responses:
        "200":
          description: A list of drivers
          headers:
            Link:
              $ref: "schemas/headers/link.yaml"
              example: </drivers?page=2>; rel="next"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "schemas/responses/driver.yaml"
    post:
      summary: Create a new driver
      description: Registers a new client account in the system..
      operationId: createDriver
      tags:
        - Drivers
      requestBody:
        required: true
        description: >
          Client information required to create a new client account.
          The email address and username must be unique.
        content:
          application/json:
            schema:
              $ref: "schemas/requests/driver-create.yaml"
      responses:
        "201":
          description: Driver created
          headers:
            Location:
              description: URI of the created driver
              schema:
                type: string
                example: "api/drivers/13"
          content:
            application/json:
              schema:
                $ref: "schemas/responses/driver.yaml"
        "400":
          $ref: "schemas/errors/bad-request.yaml"

  /drivers/{driverId}:
    get:
      parameters:
        - $ref: "#/components/parameters/DriverIdPath"
      summary: Get information of a Driver
      description: Given a driver ID, obtain the information of a Driver.
      operationId: getDriverById
      tags:
        - Drivers
      responses:
        "200":
          description: Information of a driver
          content:
            application/json:
              schema:
                $ref: "schemas/responses/driver.yaml"
        "404":
          $ref: "schemas/errors/not-found.yaml"
    patch:
      parameters:
        - $ref: "#/components/parameters/DriverIdPath"
      summary: Update driver information
      description: Updates specific fields of a driver's profile (Partial Update).
      operationId: updateDriver
      tags:
        - Drivers
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "schemas/requests/driver-update.yaml"
      responses:
        "200":
          description: Driver updated successfully
          content:
            application/json:
              schema:
                $ref: "schemas/responses/driver.yaml"
        "400":
          $ref: "schemas/errors/bad-request.yaml"
        "401":
          $ref: "schemas/errors/unauthorized.yaml"
        "403":
          description: Forbidden - Current user is not profile owner
        "404":
          $ref: "schemas/errors/not-found.yaml"

  /drivers/{driverId}/profile-picture:
    get:
      parameters:
        - $ref: "#/components/parameters/DriverIdPath"
      description: Get the profile picture of the driver id.
      operationId: getDriverProfilePicture
      tags:
        - Drivers
      responses:
        "200":
          description: Driver's profile picture
          $ref: "schemas/image.yaml"
        "404":
          $ref: "schemas/errors/image-not-found.yaml"
    post:
      parameters:
        - $ref: "#/components/parameters/DriverIdPath"
      tags:
        - Drivers
      summary: Upload driver profile picture
      description: Uploads or replaces the profile picture for a driver (format PNG or JPG).
      operationId: uploadDriverProfilePicture
      requestBody:
        required: true
        description: Image file to use as the driver’s profile picture
        $ref: "schemas/image.yaml"
      responses:
        "201":
          description: Profile picture uploaded
          headers:
            Location:
              description: URI of the uploaded image
              schema:
                type: string
                example: "api/drivers/13/profile-picture"
        "401":
          $ref: "schemas/errors/unauthorized.yaml"
        "403":
          $ref: "schemas/errors/forbidden.yaml"
        "415":
          $ref: "schemas/errors/unsupported-media-type.yaml"

  /drivers/{driverId}/vehicles:
    get:
      parameters:
        - $ref: "#/components/parameters/DriverIdPath"
        - $ref: "#/components/parameters/PaginationQuery"
      summary: List all vehicles
      description: Get all vehicles of driver with id `id`.
      operationId: listDriverVehicles
      tags:
        - Vehicles
      responses:
        "200":
          description: A list of vehicles
          headers:
            Link:
              $ref: "schemas/headers/link.yaml"
              example: </drivers?page=2>; rel="next"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "schemas/responses/vehicle.yaml"
    post:
      parameters:
        - $ref: "#/components/parameters/DriverIdPath"
      summary: Register a new vehicle
      description: Registers a new vehicle for a specific driver.
      operationId: createVehicle
      tags:
        - Vehicles
      requestBody:
        description: >
          Vehicle information required to create a new vechicle.
          The email license plate must be unique.
        required: true
        content:
          application/json:
            schema:
              $ref: "schemas/requests/vehicle-create.yaml"
      responses:
        "201":
          description: Vehicle created
          headers:
            Location:
              description: URI of the created vehicle
              schema:
                type: string
                example: "api/drivers/10/vehicles/42"
          content:
            application/json:
              schema:
                $ref: "schemas/responses/vehicle.yaml"
        "400":
          # TODO: specify what "Validation error" means
          description: Bad Request - Validation error or specified plate number already registered
        "401":
          $ref: "schemas/errors/unauthorized.yaml"
        "403":
          $ref: "schemas/errors/forbidden.yaml"

  /drivers/{driverId}/vehicles/{vehicleId}:
    get:
      parameters:
        - $ref: "#/components/parameters/DriverIdPath"
        - $ref: "#/components/parameters/VehicleIdPath"
      summary: Get information of a vehicle
      description: Given a driver ID and a vehicle ID, obtain the information of a Vehicle.
      operationId: getVehicleById
      tags:
        - Vehicles
      responses:
        "200":
          description: Information of a vehicle
          content:
            application/json:
              schema:
                $ref: "schemas/responses/vehicle.yaml"
        "404":
          $ref: "schemas/errors/not-found.yaml"
    patch:
      parameters:
        - $ref: "#/components/parameters/DriverIdPath"
        - $ref: "#/components/parameters/VehicleIdPath"
      summary: Update vehicle information
      description: Updates specific fields of a vehicle (Partial Update).
      operationId: updateVehicle
      tags:
        - Vehicles
      requestBody:
        description: Fields that may be updated for an existing vehicle.
        required: true
        content:
          application/json:
            schema:
              $ref: "schemas/requests/vehicle-update.yaml"
      responses:
        "200":
          description: Vehicle updated successfully
          content:
            application/json:
              schema:
                $ref: "schemas/responses/vehicle.yaml"
        "400":
          $ref: "schemas/errors/bad-request.yaml"
        "401":
          $ref: "schemas/errors/unauthorized.yaml"
        "403":
          description: Forbidden - Only the owner can update the vehicle
        "404":
          $ref: "schemas/errors/not-found.yaml"

  /drivers/{driverId}/vehicles/{vehicleId}/availability:
    get:
      parameters:
        - $ref: "#/components/parameters/DriverIdPath"
        - $ref: "#/components/parameters/VehicleIdPath"
      summary: Get vehicle's availability
      description: Get the vehicle's regular availability, this does not consider booked times
      operationId: listAvailability
      tags:
        - Vehicles
      responses:
        "200":
          description: A list of zones where the vehicle operates and the days and times during which it operates
          content:
            application/json:
              schema:
                $ref: "schemas/responses/availability.yaml"
        "404":
          $ref: "schemas/errors/not-found.yaml"
    patch:
      parameters:
        - $ref: "#/components/parameters/DriverIdPath"
        - $ref: "#/components/parameters/VehicleIdPath"
      summary: Update Availability for the vehicle
      # TODO: What does this mean? Can a vehicle have different time slots for different zones?
      description: Update the vehicle's availability in the specified zones (Partial Update)
      operationId: updateAvailability
      tags:
        - Vehicles
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "schemas/responses/availability.yaml"
      responses:
        "200":
          description: Availability updated successfully
          content:
            application/json:
              schema:
                $ref: "schemas/responses/availability.yaml"
        "400":
          description: Invalid zone ids or timeSlots
        "401":
          $ref: "schemas/errors/unauthorized.yaml"
        "403":
          $ref: "schemas/errors/forbidden.yaml"

  /drivers/{driverId}/vehicles/{vehicleId}/booked-times:
    get:
      parameters:
        - $ref: "#/components/parameters/DriverIdPath"
        - $ref: "#/components/parameters/VehicleIdPath"
      summary: Get booked times for the vehicle
      description: Get the times the vehicle was booked for.
      operationId: listBookedTimes
      tags:
        - Vehicles
      responses:
        "200":
          description: A list of times
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "schemas/responses/dated-time-slot.yaml"
        "404":
          $ref: "schemas/errors/not-found.yaml"

  /drivers/{driverId}/vehicles/{vehicleId}/picture:
    get:
      parameters:
        - $ref: "#/components/parameters/DriverIdPath"
        - $ref: "#/components/parameters/VehicleIdPath"
      summary: Get a vehicle's picture.
      description: Get the picture for a driver's vehicle
      operationId: getVehiclePicture
      tags:
        - Vehicles
      responses:
        "200":
          description: Image retrieved successfully
          $ref: "schemas/image.yaml"
        "404":
          $ref: "schemas/errors/image-not-found.yaml"
    post:
      parameters:
        - $ref: "#/components/parameters/DriverIdPath"
        - $ref: "#/components/parameters/VehicleIdPath"
      tags:
        - Vehicles
      summary: Upload vehicle picture
      description: Uploads or replaces the picture for a vehicle (format PNG or JPG).
      operationId: uploadVehiclePicture
      requestBody:
        required: true
        $ref: "schemas/image.yaml"
      responses:
        "201":
          description: Vehicle picture uploaded
          headers:
            Location:
              description: URI of the uploaded image
              schema:
                type: string
                example: "api/drivers/13/vehicles/42/picture"
        "401":
          $ref: "schemas/errors/unauthorized.yaml"
        "403":
          $ref: "schemas/errors/forbidden.yaml"
        "415":
          $ref: "schemas/errors/unsupported-media-type.yaml"

  /bookings:
    get:
      summary: List bookings
      description: >
        Retrieves a user's bookings. Exactly one of `fromClient` or `toDriver` must be specified.
      parameters:
        - name: fromClient
          in: query
          description: Filter bookings created by a specific client
          required: false
          schema:
            type: integer
        - name: toDriver
          in: query
          description: Filter bookings assigned to a specific driver
          required: false
          schema:
            type: integer
        - name: status
          in: query
          description: Filter bookings based on status
          required: true
          schema:
            type: string
            enum: [ PENDING, ACCEPTED, FINISHED, REJECTED, CANCELED ]
        - $ref: "#/components/parameters/PaginationQuery"
      operationId: listBookings
      tags:
        - Bookings
      responses:
        "200":
          description: List of bookings
          headers:
            Link:
              $ref: "schemas/headers/link.yaml"
              example: </bookings?page=2>; rel="next"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "schemas/responses/booking.yaml"
        "400":
          description: Invalid query parameters
        "401":
          $ref: "schemas/errors/unauthorized.yaml"
        "403":
          $ref: "schemas/errors/forbidden.yaml"
    post:
      summary: Create a new booking
      description: As a client, create a new booking
      operationId: createBooking
      tags:
        - Bookings
      requestBody:
        required: true
        # TODO: which is the error code if the vehicle is already booked?
        description: >
          Information required to create a new booking.\

          This operation will fail if the vehicle is already booked at the specified time.
        content:
          # TODO: use custom versioned mimetype?
          application/json:
            schema:
              $ref: "schemas/requests/booking-create.yaml"
      responses:
        "201":
          description: Booking created
          headers:
            Location:
              description: URI of the created booking
              schema:
                type: string
                example: "api/bookings/42"
          content:
            application/json:
              schema:
                $ref: "schemas/responses/booking.yaml"
        "400":
          $ref: "schemas/errors/bad-request.yaml"
        "401":
          $ref: "schemas/errors/unauthorized.yaml"
        "403":
          $ref: "schemas/errors/forbidden.yaml"

  /bookings/{bookingId}:
    get:
      parameters:
        - $ref: "#/components/parameters/BookingIdPath"
      summary: Get booking by ID
      description: Get booking information given a booking ID.
      operationId: getBookingById
      tags:
        - Bookings
      responses:
        "200":
          description: Booking found
          content:
            application/json:
              schema:
                $ref: "schemas/responses/booking.yaml"
        "401":
          $ref: "schemas/errors/unauthorized.yaml"
        "403":
          $ref: "schemas/errors/forbidden.yaml"
        "404":
          $ref: "schemas/errors/not-found.yaml"

  /bookings/{bookingId}/proof-of-payment:
    get:
      parameters:
        - $ref: "#/components/parameters/BookingIdPath"
      summary: Get the proof of payment
      description: Get the proof of payment for a booking given their booking ID.
      operationId: getBookingProofOfPayment
      tags:
        - Bookings
      responses:
        "200":
          description: Pdf retrieved successfully
          content:
            application/pdf:
              schema:
                type: string
                format: binary
        "401":
          $ref: "schemas/errors/unauthorized.yaml"
        "403":
          $ref: "schemas/errors/forbidden.yaml"
        "404":
          $ref: "schemas/errors/image-not-found.yaml"
    post:
      parameters:
        - $ref: "#/components/parameters/BookingIdPath"
      tags:
        - Bookings
      summary: Upload the proof of payment
      description: Uploads or replaces the proof of payment for a booking (format PDF).
      operationId: uploadBookingProofOfPayment
      requestBody:
        description: Pdf
        required: true
        content:
          application/pdf:
            schema:
              type: string
              format: binary
              description: Pdf file to use as the booking’s proof of payment.
      responses:
        "201":
          description: Proof of payment uploaded
          headers:
            Location:
              description: URI of the uploaded proof of payment
              schema:
                type: string
                example: "api/bookings/42/proof-of-payment"
        "401":
          $ref: "schemas/errors/unauthorized.yaml"
        "403":
          $ref: "schemas/errors/forbidden.yaml"
        "415":
          $ref: "schemas/errors/unsupported-media-type.yaml"

  /messages:
    get:
      parameters:
        - $ref: "#/components/parameters/DriverIdQuery"
        - $ref: "#/components/parameters/ClientIdQuery"
        - $ref: "#/components/parameters/PaginationQuery"
      tags:
        - Messages
      summary: Get messages between a client and a driver
      operationId: listMessages
      responses:
        "200":
          description: List of messages between client and driver
          headers:
            Link:
              $ref: "schemas/headers/link.yaml"
              example: </drivers?page=2>; rel="next"
          content:
            application/json:
              schema:
                $ref: "schemas/responses/messages.yaml"
              example:
                messages:
                  - id: 1
                    content: "Hola"
                    sentByDriver: true
                    timestamp: "2026-01-10T18:30:00Z"
                  - id: 2
                    sentByDriver: false
                    content: "Ya llego"
                    timestamp: "2026-01-10T18:32:00Z"
        "401":
          $ref: "schemas/errors/unauthorized.yaml"
        "403":
          description: Forbidden - User is not part of the conversation
        "404":
          $ref: "schemas/errors/not-found.yaml"
    post:
      tags:
        - Messages
      summary: Send a new message
      description: Creates a new message between a client and a driver.
      operationId: createMessage
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [clientId, driverId, content]
              properties:
                clientId:
                  type: integer
                  example: 1
                driverId:
                  type: integer
                  example: 2
                content:
                  type: string
                  example: "Hola, llego en 5 minutos."
      responses:
        "201":
          description: Message created
          headers:
            Location:
              description: URI of the created message
              schema:
                type: string
                example: "api/messages/42"
          content:
            application/json:
              schema:
                $ref: "schemas/responses/message.yaml"
        "400":
          description: Invalid Input
        "401":
          $ref: "schemas/errors/unauthorized.yaml"
        "403":
          description: Forbidden - User is not part of the conversation
        "404":
          $ref: "schemas/errors/not-found.yaml"

  /messages/{messageId}:
    get:
      parameters:
        - name: messageId
          in: path
          required: true
          description: The ID of the message to retrieve
          schema:
            type: integer
      tags:
        - Messages
      summary: Get a single message
      description: Given a message ID, obtain the message details.
      operationId: getMessageById
      responses:
        "200":
          description: Message details
          content:
            application/json:
              schema:
                $ref: "schemas/responses/message.yaml"
        "401":
          $ref: "schemas/errors/unauthorized.yaml"
        "403":
          description: Not Authorized (User is not part of the conversation)
        "404":
          $ref: "schemas/errors/not-found.yaml"

  /zones:
    get:
      tags:
        - Zones
      summary: List all Zones
      operationId: listZones
      responses:
        "200":
          description: A list of all zones
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "schemas/responses/zone.yaml"

  /zones/{zoneId}:
    get:
      parameters:
        - $ref: "#/components/parameters/ZoneIdPath"
      tags:
        - Zones
      summary: Get a zone by id
      description: Get a zone given their zone ID.
      operationId: getZoneById
      responses:
        "200":
          description: Zone retrieved
          content:
            application/json:
              schema:
                $ref: "schemas/responses/zone.yaml"
        "404":
          $ref: "schemas/errors/not-found.yaml"

components:
  parameters:
    ClientIdPath:
      name: clientId
      in: path
      required: true
      description: ID of the client
      schema:
        type: integer
    DriverIdPath:
      in: path
      name: driverId
      required: true
      description: ID of the driver
      schema:
        type: integer
    DriverIdQuery:
      name: driverId
      in: query
      required: true
      description: ID of the driver
      schema:
        type: integer
    VehicleIdPath:
      name: vehicleId
      in: path
      required: true
      description: ID of the vehicle
      schema:
        type: integer
    BookingIdPath:
      name: bookingId
      in: path
      required: true
      description: ID of the booking
      schema:
        type: integer
    ZoneIdPath:
      name: zoneId
      in: path
      required: true
      description: ID of the zone
      schema:
        type: integer
    ClientIdQuery:
      name: clientId
      in: query
      required: true
      description: ID of the client
      schema:
        type: integer
    PaginationQuery:
      name: page
      in: query
      description: Page number
      schema:
        type: integer
        default: 1
