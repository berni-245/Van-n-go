openapi: 3.1.2
info:
  title: Transport Booking API
  version: 1.0.0
  description: >
    ## Overview

    API for booking vehicles owned by drivers, used by clients.

    ## Authentication

    Methods requiring authentication should send the header `Authentication: Bearer <token>`.
    The <token> is a jwt and may be obtained by making a request to any endpoint with the header
    `Authentication: Basic <credentials>`, where `<credentials>` is the Base64 encoding of
    `<username>:<password>`. If the credentials are correct then the server will reply with the
    normal endpoint's response and a jwt in the header `vango-auth-token: <token>` and
    `vango-refresh-token: <refresh-token>`.

servers:
  - url: http://localhost:8080/api
    description: Development Server

tags:
  - name: Clients
    description: Operations related to clients.
  - name: Drivers
    description: Operations related to drivers.
  - name: Vehicles
    description: Operations related to vehicles.
  - name: Bookings
    description: Operations related to bookings
  - name: Messages
    description: Operations related to messages
  - name: Zones
    description: Operations related to zones

paths:
  /clients:
    post:
      summary: Create a new client
      description: Registers a new client account in the system.
      operationId: createClient
      tags:
        - Clients
      requestBody:
        required: true
        description: >
          Client information required to create a new client account.
          The email address must be unique.
        content:
          # TODO: use custom versioned mimetype?
          application/json:
            schema:
              $ref: "schemas/requests/client-create.yaml"
      responses:
        "201":
          description: Client created
          headers:
            Location:
              description: URI of the created client
              schema:
                type: string
                example: "/clients/42"
          content:
            application/json:
              schema:
                $ref: "schemas/responses/client.yaml"
        "400":
          description: Bad Request

  /clients/{clientId}:
    parameters:
      - $ref: "#/components/parameters/ClientIdPath"
    get:
      summary: Get information of a Client
      description: Given a client ID, obtain the information of a Client.
      operationId: getClientById
      tags:
        - Clients
      responses:
        "200":
          description: Information of a client
          content:
            application/json:
              schema:
                $ref: "schemas/responses/client.yaml"
        "401":
          description: Unauthorized
        "404":
          description: Not found
    patch:
      summary: Update client information
      description: Given a client ID, update the specified information of a Client.
      operationId: updateClientById
      tags:
        - Clients
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "schemas/requests/client-update.yaml"
      responses:
        "200":
          description: Client updated successfully
          content:
            application/json:
              schema:
                $ref: "schemas/responses/client.yaml"
        "400":
          description: Bad Request
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "404":
          description: Client not found

  /clients/{clientId}/profile-picture:
    parameters:
      - $ref: "#/components/parameters/ClientIdPath"
    get:
      summary: Get the profile picture.
      description: Get the profile picture of the client id.
      operationId: getClientProfilePicture
      tags:
        - Clients
      responses:
        "200":
          description: Image retrieved successfully
          content:
            image/png:
              schema:
                type: string
                format: binary
            image/jpeg:
              schema:
                type: string
                format: binary
        "401":
          description: Unauthorized
        "404":
          description: Image not found
    post:
      tags:
        - Clients
      summary: Upload client profile picture
      description: Uploads or replaces the profile picture for a client (format PNG or JPG).
      operationId: uploadClientProfilePicture
      requestBody:
        description: Image
        required: true
        content:
          # TODO: not sure how to add the example in this case.
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: Image file to use as the client’s profile picture
      responses:
        "201":
          description: Profile picture uploaded
          headers:
            Location:
              description: URI of the uploaded image
              schema:
                type: string
                example: "/client/42/profile-picture"
          content:
            application/json:
              schema:
                type: object
                properties:
                  profilePic:
                    type: string
                    format: uri
                    example: https://cdn.example.com/clients/42.jpg
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "415":
          description: Unsupported Media Type

  /drivers:
    get:
      summary: List all drivers
      parameters:
        - name: originZoneId
          in: query
          description: Filter drivers by an specific starting zone
          required: true
          schema:
            type: integer
        - name: size
          in: query
          description: Filter drivers that have a vehicle of an specific size
          required: false
          schema:
            type: string
            enum: [MANDADO, FLETE, "CARGA_PESADA"]
        - name: maxPrice
          in: query
          required: false
          schema:
            type: number
            format: float
        - name: weekDay
          in: query
          required: false
          schema:
            type: string
            enum:
              [MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY]
        - name: minRating
          in: query
          required: false
          schema:
            type: integer
        - name: sortOrder
          in: query
          schema:
            type: string
            default: ALPHABETICAL
            enum: [ALPHABETICAL, "LEAST_PRICE", "BEST_RATING"]
        - $ref: "#/components/parameters/PaginationQuery"
      description: Get list of all drivers in the system.
      operationId: listDrivers
      tags:
        - Drivers
      responses:
        "200":
          description: A list of drivers
          headers:
            Link:
              description: >
                Links to navigation (next, prev, first, last) according to RFC 5988.
                Example: </drivers?page=2>; rel="next"
              schema:
                type: string
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "schemas/responses/driver.yaml"
    post:
      summary: Create a new driver
      description: Registers a new client account in the system..
      operationId: createDriver
      tags:
        - Drivers
      requestBody:
        required: true
        description: >
          Client information required to create a new client account.
          The email address and username must be unique.
        content:
          application/json:
            schema:
              $ref: "schemas/requests/driver-create.yaml"
      responses:
        "201":
          description: Driver created
          headers:
            Location:
              description: URI of the created driver
              schema:
                type: string
                example: "/drivers/13"
          content:
            application/json:
              schema:
                $ref: "schemas/responses/driver.yaml"
        "400":
          description: Bad Request (Validation error or Duplicate email)

  /drivers/{driverId}:
    parameters:
      - $ref: "#/components/parameters/DriverIdPath"
    get:
      summary: Get information of a Driver
      description: Given a driver ID, obtain the information of a Driver.
      operationId: getDriverById
      tags:
        - Drivers
      responses:
        "200":
          description: Information of a driver
          content:
            application/json:
              schema:
                $ref: "schemas/responses/driver.yaml"
        "404":
          description: Not found
    patch:
      summary: Update driver information
      description: Updates specific fields of a driver's profile (Partial Update).
      operationId: updateDriver
      tags:
        - Drivers
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "schemas/requests/driver-update.yaml"
      responses:
        "200":
          description: Driver updated successfully
          content:
            application/json:
              schema:
                $ref: "schemas/responses/driver.yaml"
        "400":
          description: Bad Request
        "401":
          description: Unauthorized
        "403":
          description: Forbidden (Only the driver themselves can update their profile)
        "404":
          description: Driver not found
  /drivers/{driverId}/profile-picture:
    parameters:
      - $ref: "#/components/parameters/DriverIdPath"
    get:
      summary: Get the profile picture.
      description: Get the profile picture of the driver id.
      operationId: getDriverProfilePicture
      tags:
        - Drivers
      responses:
        "200":
          description: Image retrieved successfully
          content:
            image/png:
              schema:
                type: string
                format: binary
            image/jpeg:
              schema:
                type: string
                format: binary
        "404":
          description: Image not found
    post:
      tags:
        - Drivers
      summary: Upload driver profile picture
      description: Uploads or replaces the profile picture for a driver (format PNG or JPG).
      operationId: uploadDriverProfilePicture
      requestBody:
        description: Image
        required: true
        content:
          # TODO: not sure how to add the example in this case.
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: Image file to use as the driver’s profile picture
      responses:
        "201":
          description: Profile picture uploaded
          headers:
            Location:
              description: URI of the uploaded image
              schema:
                type: string
                example: "/drivers/13/profile-picture"
          content:
            application/json:
              schema:
                type: object
                properties:
                  profilePic:
                    type: string
                    format: uri
                    example: https://cdn.example.com/drivers/42.jpg
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "415":
          description: Unsupported Media Type

  /drivers/{driverId}/vehicles:
    parameters:
      - $ref: "#/components/parameters/DriverIdPath"
    get:
      summary: List all vehicles
      description: Get all vehicles of driver with id `id`.
      operationId: listDriverVehicles
      parameters:
        - $ref: "#/components/parameters/PaginationQuery"
      tags:
        - Vehicles
      responses:
        "200":
          description: A list of vehicles
          headers:
            Link:
              description: >
                Links to navigation (next, prev, first, last) according to RFC 5988.
                Example: </drivers?page=2>; rel="next"
              schema:
                type: string
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "schemas/responses/vehicle.yaml"
    post:
      summary: Register a new vehicle
      description: Registers a new vehicle for a specific driver.
      operationId: createVehicle
      tags:
        - Vehicles
      requestBody:
        description: >
          Vehicle information required to create a new vechicle.
          The email license plate must be unique.
        required: true
        content:
          application/json:
            schema:
              $ref: "schemas/requests/vehicle-create.yaml"
      responses:
        "201":
          description: Vehicle created
          headers:
            Location:
              description: URI of the created vehicle
              schema:
                type: string
                example: "/drivers/10/vehicles/42"
          content:
            application/json:
              schema:
                $ref: "schemas/responses/vehicle.yaml"
        "400":
          description: Bad Request (Validation error or Vehicle with that plate number exists)
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  /drivers/{driverId}/vehicles/{vehicleId}:
    parameters:
      - $ref: "#/components/parameters/DriverIdPath"
      - $ref: "#/components/parameters/VehicleIdPath"
    get:
      summary: Get information of a vehicle
      description: Given a driver ID and a vehicle ID, obtain the information of a Vehicle.
      operationId: getVehicleById
      tags:
        - Vehicles
      responses:
        "200":
          description: Information of a vehicle
          content:
            application/json:
              schema:
                $ref: "schemas/responses/vehicle.yaml"
        "404":
          description: Not found
    patch:
      summary: Update vehicle information
      description: Updates specific fields of a vehicle (Partial Update).
      operationId: updateVehicle
      tags:
        - Vehicles
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "schemas/requests/vehicle-update.yaml"
      responses:
        "200":
          description: Vehicle updated successfully
          content:
            application/json:
              schema:
                $ref: "schemas/responses/vehicle.yaml"
        "400":
          description: Bad Request
        "401":
          description: Unauthorized
        "403":
          description: Forbidden (Only the owner can update the vehicle)
        "404":
          description: Vehicle or Driver not found

  /drivers/{driverId}/vehicles/{vehicleId}/availability:
    parameters:
      - $ref: "#/components/parameters/DriverIdPath"
      - $ref: "#/components/parameters/VehicleIdPath"
    get:
      summary: Get availability from the vehicle
      description: Get the regular availability from the vehicle, this does not consider booked times.
      operationId: listAvailability
      tags:
        - Vehicles
      responses:
        "200":
          description: A list of times
          content:
            application/json:
              schema:
                $ref: "schemas/responses/availability.yaml"
        "404":
          description: Not Found
    patch:
      summary: Update Availability for the vehicle
      description: Update the regular availability for the vehicle in the zonesIds given (Partial Update)
      operationId: updateAvailability
      tags:
        - Vehicles
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "schemas/responses/availability.yaml"
      responses:
        "200":
          description: Availability updated successfully
          content:
            application/json:
              schema:
                $ref: "schemas/responses/availability.yaml"
        "400":
          description: Invalid zone ids or timeSlots
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  /drivers/{driverId}/vehicles/{vehicleId}/booked-times:
    parameters:
      - $ref: "#/components/parameters/DriverIdPath"
      - $ref: "#/components/parameters/VehicleIdPath"
    get:
      summary: Get booked times for the vehicle
      description: Get the times the vehicle was booked for.
      operationId: listBookedTimes
      tags:
        - Vehicles
      responses:
        "200":
          description: A list of times
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "schemas/responses/dated-time-slot.yaml"
        "404":
          description: Not Found

  /drivers/{driverId}/vehicles/{vehicleId}/picture:
    parameters:
      - $ref: "#/components/parameters/DriverIdPath"
      - $ref: "#/components/parameters/VehicleIdPath"
    get:
      summary: Get the vehicle picture.
      description: Get the vehicle picture of the driver id and vehicle id.
      operationId: getVehiclePicture
      tags:
        - Vehicles
      responses:
        "200":
          description: Image retrieved successfully
          content:
            image/png:
              schema:
                type: string
                format: binary
            image/jpeg:
              schema:
                type: string
                format: binary
        "404":
          description: Image not found
    post:
      tags:
        - Vehicles
      summary: Upload vehicle picture
      description: Uploads or replaces the picture for a vehicle (format PNG or JPG).
      operationId: uploadVehiclePicture
      requestBody:
        description: Image
        required: true
        content:
          # TODO: not sure how to add the example in this case.
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: Image file to use as the vehicle’s profile picture
      responses:
        "201":
          description: Profile picture uploaded
          headers:
            Location:
              description: URI of the uploaded image
              schema:
                type: string
                example: "/drivers/13/vehicles/42/picture"
          content:
            application/json:
              schema:
                type: object
                properties:
                  profilePic:
                    type: string
                    format: uri
                    example: https://cdn.example.com/vehicles/42.jpg
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "415":
          description: Unsupported Media Type

  /bookings:
    get:
      summary: List bookings
      parameters:
        - name: fromClient
          in: query
          description: Filter bookings created by a specific client
          required: false
          schema:
            type: integer
        - name: toDriver
          in: query
          description: Filter bookings assigned to a specific driver
          required: false
          schema:
            type: integer
        - name: status
          in: query
          description: Filter bookings based on status
          required: true
          schema:
            type: string
            enum:
              - PENDING
              - ACCEPTED
              - FINISHED
              - REJECTED
              - CANCELED
        - $ref: "#/components/parameters/PaginationQuery"
      description: >
        Retrieves bookings optionally filtered by client or driver.
        Only one filter is expected at a time.
      operationId: listBookings
      tags:
        - Bookings
      responses:
        "200":
          description: List of bookings
          headers:
            Link:
              description: >
                Links to navigation (next, prev, first, last) according to RFC 5988.
                Example: </bookings?page=2>; rel="next"
              schema:
                type: string
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "schemas/responses/booking.yaml"

        "400":
          description: Invalid query parameters
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

    post:
      summary: Create a new booking
      description: As a client, create a new booking
      operationId: createBooking
      tags:
        - Bookings
      requestBody:
        required: true
        description: >
          Booking information required to create a new booking.
          The vehicle must not be booked already at that time.
        content:
          # TODO: use custom versioned mimetype?
          application/json:
            schema:
              $ref: "schemas/requests/booking-create.yaml"
      responses:
        "201":
          description: Booking created
          headers:
            Location:
              description: URI of the created booking
              schema:
                type: string
                example: "/bookings/42"
          content:
            application/json:
              schema:
                $ref: "schemas/responses/booking.yaml"
        "400":
          description: "Bad Request: Bad format of the body provided"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  /bookings/{bookingId}:
    parameters:
      - $ref: "#/components/parameters/BookingIdPath"
    get:
      summary: Get booking by ID
      description: Get booking information given a booking ID.
      operationId: getBookingById
      tags:
        - Bookings
      responses:
        "200":
          description: Booking found
          content:
            application/json:
              schema:
                $ref: "schemas/responses/booking.yaml"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "404":
          description: Booking not found

  /bookings/{bookingId}/proof-of-payment:
    parameters:
      - $ref: "#/components/parameters/BookingIdPath"
    get:
      summary: Get the proof of payment
      description: Get the proof of payment for a booking given their booking ID.
      operationId: getBookingProofOfPayment
      tags:
        - Bookings
      responses:
        "200":
          description: Pdf retrieved successfully
          content:
            application/pdf:
              schema:
                type: string
                format: binary
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "404":
          description: Image not found
    post:
      tags:
        - Bookings
      summary: Upload the proof of payment
      description: Uploads or replaces the proof of payment for a booking (format PDF).
      operationId: uploadBookingProofOfPayment
      requestBody:
        description: Pdf
        required: true
        content:
          # TODO: not sure how to add the example in this case.
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: Pdf file to use as the booking’s proof of payment.
      responses:
        "201":
          description: Proof of payment uploaded
          headers:
            Location:
              description: URI of the uploaded proof of payment
              schema:
                type: string
                example: "/bookings/42/proof-of-payment"

          content:
            application/json:
              schema:
                type: object
                properties:
                  proofOfPaymentURI:
                    type: string
                    format: uri
                    example: "https://cdn.example.com/bookings/42/proof-of-payment"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "415":
          description: Unsupported Media Type

  /messages:
    get:
      tags:
        - Messages
      summary: Get messages between a client and a driver
      operationId: listMessages
      parameters:
        - $ref: "#/components/parameters/DriverIdQuery"
        - $ref: "#/components/parameters/ClientIdQuery"
        - $ref: "#/components/parameters/PaginationQuery"

      responses:
        "200":
          description: List of messages between client and driver
          headers:
            Link:
              description: >
                Links to navigation (next, prev, first, last) according to RFC 5988.
                Example: </drivers?page=2>; rel="next"
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: "schemas/responses/messages.yaml"
              example:
                messages:
                  - id: 1
                    content: "Hola"
                    sentByDriver: true
                    timestamp: "2026-01-10T18:30:00Z"
                  - id: 2
                    sentByDriver: false
                    content: "Ya llego"
                    timestamp: "2026-01-10T18:32:00Z"
        "401":
          description: Auth required
        "403":
          description: Forbidden (User is not part of the conversation)
        "404":
          description: Driver or Client not found

    post:
      tags:
        - Messages
      summary: Send a new message
      description: Creates a new message between a client and a driver.
      operationId: createMessage
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [clientId, driverId, content]
              properties:
                clientId:
                  type: integer
                driverId:
                  type: integer
                content:
                  type: string
                  example: "Hola, llego en 5 minutos."
      responses:
        "201":
          description: Message created
          headers:
            Location:
              description: URI of the created message
              schema:
                type: string
                example: "/messages/42"
          content:
            application/json:
              schema:
                $ref: "schemas/responses/message.yaml"
        "400":
          description: Invalid Input
        "401":
          description: Auth required
        "403":
          description: Forbidden (User is not part of the conversation)
        "404":
          description: Driver or Client not found

  /messages/{messageId}:
    parameters:
      - name: messageId
        in: path
        required: true
        description: The ID of the message to retrieve
        schema:
          type: integer

    get:
      tags:
        - Messages
      summary: Get a single message
      description: Given a message ID, obtain the message details.
      operationId: getMessageById
      responses:
        "200":
          description: Message details
          content:
            application/json:
              schema:
                $ref: "schemas/responses/message.yaml"
        "401":
          description: Auth required
        "403":
          description: Not Authorized (User is not part of the conversation)
        "404":
          description: Message not found

  /zones:
    get:
      tags:
        - Zones
      summary: List all Zones
      operationId: listZones
      responses:
        "200":
          description: A list of all zones
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "schemas/responses/zone.yaml"

  /zones/{zoneId}:
    parameters:
      - $ref: "#/components/parameters/ZoneIdPath"
    get:
      tags:
        - Zones
      summary: Get a zone by id
      description: Get a zone given their zone ID.
      operationId: getZoneById
      responses:
        "200":
          description: Zone retrieved
          content:
            application/json:
              schema:
                $ref: "schemas/responses/zone.yaml"
        "404":
          description: Not Found

components:
  parameters:
    ClientIdPath:
      name: clientId
      in: path
      required: true
      description: ID of the client
      schema:
        type: integer
    DriverIdPath:
      name: driverId
      in: path
      required: true
      description: ID of the driver
      schema:
        type: integer
    DriverIdQuery:
      name: driverId
      in: query
      required: true
      description: ID of the driver
      schema:
        type: integer
    VehicleIdPath:
      name: vehicleId
      in: path
      required: true
      description: ID of the vehicle
      schema:
        type: integer
    BookingIdPath:
      name: bookingId
      in: path
      required: true
      description: ID of the booking
      schema:
        type: integer
    ZoneIdPath:
      name: zoneId
      in: path
      required: true
      description: ID of the zone
      schema:
        type: integer
    ClientIdQuery:
      name: clientId
      in: query
      required: true
      description: ID of the client
      schema:
        type: integer
    PaginationQuery:
      name: page
      in: query
      description: Page number
      schema:
        type: integer
        default: 1
